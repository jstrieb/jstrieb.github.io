<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="author" content="Jacob Strieb" />
  <meta name="date" content="2022-10-05" />
  <meta name="dcterms.date" content="2022-10-05" />
  <meta name="description" content="<p>Calculating the rate of occurrence of characters in English text is useful for frequency analysis. It is possible with this simple shell script.</p>" />
  <title>Frequency Analysis From the Shell - Jacob Strieb</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #aaaaaa; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #c072ca; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="/style.css" type="text/css" />
</head>
<body>
<div class="menu">
<ul>
<li><a href="/">Home</a></li>
<li><a href="/about/">About</a></li>
<li><a href="https://github.com/jstrieb">Projects</a></li>
<li><a href="/posts/">Posts</a></li>
</ul>
<hr />
</div>
<h1 id="frequency-analysis-from-the-shell">Frequency Analysis From the Shell</h1>
<p>By <a href="https://jstrieb.github.io">Jacob Strieb</a>.</p>
<p>Published on <a href="/posts/frequency-histogram">October 5, 2022</a>.</p>
<hr />
<p>Recently, in the course of performing cryptanalysis, I needed the relative frequencies with which each character—symbols and punctuation included—occurs in English text. Web searches seemed to only return results for letter frequencies, with no symbols and no distinction between uppercase and lowercase letters, so I resolved to sample the frequencies myself.</p>
<p>I chose to sample text from <a href="https://www.gutenberg.org/browse/scores/top">books hosted by Project Gutenberg</a> since they are free, legal, and easy to access. Even better, they’re available as plain text files.</p>
<p>Since this was a low-stakes, one-off task, I decided the ceremony of a full-blown program was overkill, and opted for a shell script instead. Plus text wrangling is the shell’s bread and butter.</p>
<p>The first major step was to get links to books to download. The snippet below:</p>
<ol type="1">
<li>Pulls the list of top books</li>
<li>Extracts links to books matching a known pattern</li>
<li>Ensures that no book links are repeated</li>
<li>Converts each relative book page path to an absolute link pointing to the respective ebook text file</li>
<li>Randomly shuffles the order of the book URLs</li>
<li>Takes 16 book URLs from the shuffled list</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="va">NUM_BOOKS=</span>16</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="ex">curl</span> <span class="st">&quot;https://gutenberg.org/browse/scores/top&quot;</span> <span class="kw">\</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">egrep</span> -o <span class="st">&#39;href=&quot;/ebooks/[0-9]+&quot;&#39;</span> <span class="kw">\</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">\</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">uniq</span> <span class="kw">\</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/href=&quot;\/ebooks\/\([0-9]\+\)&quot;/https:\/\/gutenberg.org\/ebooks\/\1.txt.utf-8/&#39;</span> <span class="kw">\</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>  <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">\</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">head</span> -n <span class="st">&quot;</span><span class="va">${NUM_BOOKS}</span><span class="st">&quot;</span> <span class="kw">\</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>  <span class="co"># ...</span></span></code></pre></div>
<p>The number of books to sample can be tuned for greater accuracy at the expense of longer running time. Since some of the Project Gutenberg works may be short or may not be representative of the distribution of symbols in typical English text, increasing this number reduces the risk of a skewed sample. Likewise, the <code>shuf</code> can be removed for deterministic output.</p>
<p>After getting book text URLs, the next step was to fetch the text from each of the links, concatenate it, and clean it up. The snippet below:</p>
<ol type="1">
<li>Fetches the text from each of the links (parallelized across four cores) and writes the text to the standard output</li>
<li>Duplicates the concatenated text to a file called <code>test.txt</code></li>
<li>Replaces angled quotation marks with straight ones</li>
<li>Strips all non-printable, non-space characters</li>
<li>Collapses all contiguous sequences of whitespace down to a single space character and removes whitespace (usually indentation) at the beginning of lines</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>  <span class="co"># ... \</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">xargs</span> -L 1 -P 4 curl -L --compressed <span class="kw">\</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">tee</span> text.txt <span class="kw">\</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/”\|“/&quot;/g&#39;</span> <span class="kw">\</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">tr</span> -c -d <span class="st">&#39;[:print:]&#39;</span> <span class="kw">\</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/[[:space:]]\+/ /g&#39;</span> <span class="kw">\</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/^[[:space:]]*//g&#39;</span> <span class="kw">\</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>  <span class="co"># ...</span></span></code></pre></div>
<p>Next, the snippet below:</p>
<ol type="1">
<li>Puts each character on its own line</li>
<li>Counts the occurrences of each line and returns the results sorted least to greatest</li>
<li>Saves the raw frequency data to a file</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>  <span class="co"># ... \</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/\(.\)/\1\n/g&#39;</span> <span class="kw">\</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">\</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">uniq</span> -c <span class="kw">\</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sort</span> -n <span class="kw">\</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">tee</span> frequency.txt <span class="kw">\</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>  <span class="co"># ...</span></span></code></pre></div>
<p>Finally, I got lazy and decided to pass the rest to a small Python script, since I’ve never been fond of doing math in the shell. The snippet below:</p>
<ol type="1">
<li>Reads all lines in from the standard input</li>
<li>Parses the input lines into a dictionary mapping letters to counts</li>
<li>Calculates the total number of characters</li>
<li>Creates a new dictionary calculating the proportional occurrence of each character</li>
<li>Dumps the last dictionary as pretty-printed JSON with two-space indents</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>  <span class="co"># ... \</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>  <span class="kw">|</span> <span class="ex">python3</span> -c <span class="st">&#39;import sys, json; \</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="st">    lines = sys.stdin.readlines(); \</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="st">    data = {l.strip(): int(n.strip()) for n, l in map(lambda x: x.split(), lines[:-1])}; \</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="st">    data[&quot; &quot;] = int(lines[-1].strip()); \</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="st">    total = sum(data.values()); \</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="st">    data = {k: v / total for k, v in data.items()};  \</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a><span class="st">    print(json.dumps(data, indent=2))&#39;</span> <span class="kw">\</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>  <span class="op">&gt;</span> <span class="ex">frequency.json</span></span></code></pre></div>
<p>Though this hardly counts as a one-liner, here is the whole pipeline in its full glory:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="co">#!/bin/bash</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="co"># Calculate symbol frequency histogram from some of the top 100 Project</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="co"># Gutenberg books.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="va">NUM_BOOKS=</span>32</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a><span class="ex">curl</span> <span class="st">&quot;https://gutenberg.org/browse/scores/top&quot;</span> <span class="kw">\</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">egrep</span> -o <span class="st">&#39;href=&quot;/ebooks/[0-9]+&quot;&#39;</span> <span class="kw">\</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">\</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">uniq</span> <span class="kw">\</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/href=&quot;\/ebooks\/\([0-9]\+\)&quot;/https:\/\/gutenberg.org\/ebooks\/\1.txt.utf-8/&#39;</span> <span class="kw">\</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>  <span class="kw">|</span> <span class="ex">shuf</span> <span class="kw">\</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">head</span> -n <span class="st">&quot;</span><span class="va">${NUM_BOOKS}</span><span class="st">&quot;</span> <span class="kw">\</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">xargs</span> -L 1 -P 4 curl -L --compressed <span class="kw">\</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">tee</span> text.txt <span class="kw">\</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/”\|“/&quot;/g&#39;</span> <span class="kw">\</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">tr</span> -c -d <span class="st">&#39;[:print:]&#39;</span> <span class="kw">\</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/[[:space:]]\+/ /g&#39;</span> <span class="kw">\</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/^[[:space:]]*//g&#39;</span> <span class="kw">\</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/\(.\)/\1\n/g&#39;</span> <span class="kw">\</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sort</span> <span class="kw">\</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">uniq</span> -c <span class="kw">\</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">sort</span> -n <span class="kw">\</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true"></a>  <span class="kw">|</span> <span class="fu">tee</span> frequency.txt <span class="kw">\</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true"></a>  <span class="kw">|</span> <span class="ex">python3</span> -c <span class="st">&#39;import sys, json; \</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true"></a><span class="st">    lines = sys.stdin.readlines(); \</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true"></a><span class="st">    data = {l.strip(): int(n.strip()) for n, l in map(lambda x: x.split(), lines[:-1])}; \</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true"></a><span class="st">    data[&quot; &quot;] = int(lines[-1].strip()); \</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true"></a><span class="st">    total = sum(data.values()); \</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true"></a><span class="st">    data = {k: v / total for k, v in data.items()};  \</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true"></a><span class="st">    print(json.dumps(data, indent=2))&#39;</span> <span class="kw">\</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true"></a>  <span class="op">&gt;</span> <span class="ex">frequency.json</span></span></code></pre></div>
<footer>
<hr />
Copyright &copy 2022 <a href="/about">Jacob Strieb</a>. All rights reserved.
</footer>
</body>
</html>
