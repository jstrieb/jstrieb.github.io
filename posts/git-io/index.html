<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="author" content="Jacob Strieb" />
  <meta name="date" content="2020-11-22" />
  <meta name="dcterms.date" content="2020-11-22" />
  <meta name="description" content="GitHub has a link shortener that only works for GitHub domains, but this can be circumvented by using URL Pages and JavaScript redirects." />
  <title>Abusing the GitHub URL Shortener</title>
  <link rel="stylesheet" href="/style.css" type="text/css" />
</head>
<body>
<div class="menu">
<ul>
<li><a href="/">Home</a></li>
<li><a href="/about/">About</a></li>
<li><a href="https://github.com/jstrieb">Projects</a></li>
<li><a href="/posts/">Posts</a></li>
</ul>
<hr />
</div>
<h1 id="abusing-the-github-url-shortener">Abusing the GitHub URL Shortener</h1>
<p>By <a href="https://jstrieb.github.io">Jacob Strieb</a></p>
<p>Published on <a href="/posts/git-io/">November 23, 2020</a></p>
<hr />
<h2 id="edit-january-11-2022">Edit (January 11, 2022)</h2>
<p>As of today, GitHub is no longer accepting new URLs at git.io. That means that this article is no longer relevant, and the code featured below probably won’t work. For more, read their blog post here:</p>
<p><a href="https://github.blog/changelog/2022-01-11-git-io-no-longer-accepts-new-urls/" class="uri">https://github.blog/changelog/2022-01-11-git-io-no-longer-accepts-new-urls/</a></p>
<hr style="margin: 1em 0;" />
<p>Since creating <a href="https://github.com/jstrieb/urlpages">URL Pages</a>, I have been looking for a URL shortener that does not limit the length of submitted links, since those generated by URL Pages can be obscenely long. Even the most generous shortening services I have discovered limit the URL size to between 2,000 and 5,000 bytes. Recently, however, a user on GitHub pointed out the existence of a GitHub-exclusive link shortener.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Released in 2011,<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> the service lives at <a href="https://git.io">git.io</a>. Excitingly, some testing revealed that it does not seem to have a length limit on submitted URLs!</p>
<p>Despite being very useful for reducing the size of long URL Pages links, git.io is unusable for pages that are not on a GitHub domain. But by using URL Pages and JavaScript’s <code>window.location.replace</code> function, we can work around this!</p>
<p>The form below will fill the given URL into the following HTML template, generate a URL Pages link for it, and then retrieve the <code>git.io</code> shortened link. This will use JavaScript to redirect to the original URL entered by the user. We can now shorten URLs from any domain—of any length—using the GitHub link shortener!</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">&lt;html&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">&lt;script&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="bu">window</span><span class="op">.</span><span class="at">location</span><span class="op">.</span><span class="fu">replace</span>(<span class="st">&quot;{{ INPUT URL }}&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">&lt;/script&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<script src="//jstrieb.github.io/urlpages/b64.js"></script>
<script src="//jstrieb.github.io/urlpages/api.js"></script>
<style>
form, label {
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;
  justify-content: flex-start;
  align-items: stretch;
}

form {
  gap: 1em;
}

.buttons {
  display: flex;
  flex-wrap: nowrap;
  align-items: baseline;
  gap: 1em;
}

.buttons #alert {
  flex-grow: 1;
}
</style>
<form onsubmit="shorten(this); return false;" method="post">
<label for="orig_url">URL to shorten: <input name="orig_url" type="text" /></label> <input name="url" type="hidden" /> <label for="url">Custom alias (optional): <input name="code" type="text" /></label>
<div class="buttons">
<a id="alert" class="alert"></a> <button>Submit</button>
</div>
</form>
<script>
let api = apiVersions[LATEST_API_VERSION];

function error(message) {
  const alert = document.querySelector("#alert");
  alert.innerText = message;
  try {
    new URL(message);
    alert.href = message;
  } catch (err) {
    alert.href = "";
  }
  alert.style.opacity = 1;
}

function shorten(form) {
  let orig_url = form.elements['orig_url'].value;
  try {
    new URL(orig_url);
  } catch (err) {
    error("Bad URL");
    return;
  }

  let pageData = `
<html>
<scr` + `ipt>
window.location.replace("${orig_url}")
</scr` + `ipt>
</html>
`;
  let url = api.getViewLink(pageData);
  console.log(url);
  let formData = new FormData(form);
  formData.delete("orig_url");
  if (!formData.get("code")) formData.delete("code");
  formData.set("url", url);
  // fetch("https://git.io/", {
  fetch("https://cors.jstrieb.workers.dev/https://git.io/", {
    "body": formData,
    "method": "POST"
  })
  .then(r => {
    if (r.status >= 400)
      return error("Error! Possibly, the alias is already in use!");
    r.headers.forEach(console.log)
    let short = r.headers.get("location");
    console.log(r);
    console.log(short);
    console.log(r.headers);
    error(short);
    // setTimeout(() => alert.style.opacity = 0, 5000);
  })
  .catch(error);
}
</script>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p><a href="https://github.com/jstrieb/link-lock/issues/2" class="uri">https://github.com/jstrieb/link-lock/issues/2</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p><a href="https://github.blog/2011-11-10-git-io-github-url-shortener/" class="uri">https://github.blog/2011-11-10-git-io-github-url-shortener/</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<footer>
<hr />
<p>Copyright &copy; 2024 <a href="/about">Jacob Strieb</a>. All rights reserved.</p>
</footer>
</body>
</html>
